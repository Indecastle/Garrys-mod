--@name Test Coroutine PropCreate
--@author
--@server

--@include https://raw.githubusercontent.com/Jacbo1/Public-Starfall/main/SafeNet/safeNet.lua as SafeNet
--@include https://raw.githubusercontent.com/Jacbo1/Public-Starfall/refs/heads/main/Spawn%20Blocking/spawn_blocking.lua as SpawnBlocking

local oldNet = net
local net = require("SafeNet")
require("SpawnBlocking")
----------------------------------------------------------------------------


local ServerQuotaP, ServerQuota = 0.4, 0.010
local ClientQuotaP, ClientQuota = 0.4, 0.010


----------------------------------------------------------------------------

local _maxQuota = SERVER and math.min(ServerQuota, quotaMax() * ServerQuotaP) or math.min(ClientQuota, quotaMax() * ClientQuotaP)

function checkQuota()
    return math.max(quotaAverage(), quotaUsed()) < _maxQuota
end

function validQuota()
    while !checkQuota() do
        coroutine.yield()
    end
end

function corDelay(delay)
    local endTime = timer.curtime() + delay
    while timer.curtime() < endTime do
        coroutine.yield()
    end
end

----------------------------------------------------------------------------

corWrap(function()
    
print("__Start__")
for i=1, 10 do
    prop.create(chip():getPos() + Vector(0,0,100), Angle(), "models/props_c17/oildrum001_explosive.mdl", false)
    --validQuota()
    corDelay(1)
end
print("__End__")

end)